stripq = (str) -> str\gsub "[\"']", ''

stripnl = (str) -> str\gsub '(.+)\n+', '%1'

-- example: exec_cmd_w [[ yue -e 'print _VERSION .. os.getenv '\''VAR'\''' ]], { env: { 'VAR': 'xyz' } }
-- see:
--   https://man7.org/linux/man-pages/man3/popen.3.html
-- returns: success (boolean), exit_type ('exit'|'signal'), exit_code (number)
exec_cmd_w = (cmd, opts = {}) ->
  if opts.chdir
    cmd = "cd #{ opts.chdir } && #{ cmd }"
  if opts.env
    for k, v in pairs opts.env
      cmd = "#{ k }='#{ v }' #{ cmd }"

  p = io.popen cmd, 'w'
  if opts.stdin
    p\write opts.stdin
  ok, exit_type, code = p\close!

  (ok == true), exit_type, code
